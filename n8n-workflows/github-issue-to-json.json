{
  "name": "GitHub Issue to JSON Converter",
  "nodes": [
    {
      "id": "1",
      "name": "GitHub Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [250, 300],
      "parameters": {
        "path": "github-issue-webhook",
        "httpMethod": "POST",
        "authentication": "headerAuth",
        "headerAuth": {
          "name": "X-GitHub-Event",
          "value": "issues"
        }
      }
    },
    {
      "id": "2", 
      "name": "Parse Issue Content",
      "type": "n8n-nodes-base.code",
      "position": [450, 300],
      "parameters": {
        "language": "javascript",
        "code": "// GitHub Issue íŒŒì‹±\nconst issueBody = $input.first().json.issue.body;\nconst title = $input.first().json.issue.title;\n\n// ì •ê·œì‹ìœ¼ë¡œ ê° ì„¹ì…˜ ì¶”ì¶œ\nconst parseSection = (section) => {\n  const regex = new RegExp(`## ${section}\\\\s*\\\\n([\\\\s\\\\S]*?)(?=##|$)`, 'i');\n  const match = issueBody.match(regex);\n  return match ? match[1].trim() : '';\n};\n\n// íšŒì°¨ì™€ ë¬¸ì œ ë²ˆí˜¸ ì¶”ì¶œ (ì œëª©ì—ì„œ)\nconst titleMatch = title.match(/\\[(\\d+)íšŒ-(\\d+)\\]/);\nconst examYear = titleMatch ? titleMatch[1] : '';\nconst questionNumber = titleMatch ? parseInt(titleMatch[2]) : 0;\n\n// ê³¼ëª© ì¶”ì¶œ\nconst subjectSection = parseSection('ê³¼ëª©');\nlet subject = '';\nif (subjectSection.includes('ìˆ˜ëª©ë³‘ë¦¬í•™')) subject = 'ìˆ˜ëª©ë³‘ë¦¬í•™';\nelse if (subjectSection.includes('ìˆ˜ëª©í•´ì¶©í•™')) subject = 'ìˆ˜ëª©í•´ì¶©í•™';\nelse if (subjectSection.includes('ìˆ˜ëª©ìƒë¦¬í•™')) subject = 'ìˆ˜ëª©ìƒë¦¬í•™';\nelse if (subjectSection.includes('ì‚°ë¦¼í† ì–‘í•™')) subject = 'ì‚°ë¦¼í† ì–‘í•™';\nelse if (subjectSection.includes('ì •ì±… ë° ë²•ê·œ')) subject = 'ì •ì±… ë° ë²•ê·œ';\n\n// ë¬¸ì œ ë‚´ìš© ì¶”ì¶œ\nconst question = parseSection('ë¬¸ì œ ë‚´ìš©').replace(/```/g, '').trim();\n\n// ì„ íƒì§€ ì¶”ì¶œ\nconst choicesText = parseSection('ì„ íƒì§€').replace(/```/g, '').trim();\nconst choices = {};\nconst choiceRegex = /([â‘ â‘¡â‘¢â‘£â‘¤]|[1-5][).]?)\\s*(.+)/g;\nlet match;\nwhile ((match = choiceRegex.exec(choicesText)) !== null) {\n  const num = match[1].replace(/[â‘ â‘¡â‘¢â‘£â‘¤]/, (m) => 'â‘ â‘¡â‘¢â‘£â‘¤'.indexOf(m) + 1);\n  choices[num] = match[2].trim();\n}\n\n// ì •ë‹µ ì¶”ì¶œ\nconst answerSection = parseSection('ì •ë‹µ');\nconst answerMatch = answerSection.match(/ì •ë‹µ ë²ˆí˜¸[\\s:]*([1-5â‘ â‘¡â‘¢â‘£â‘¤])/);\nconst answer = answerMatch ? parseInt(answerMatch[1].replace(/[â‘ â‘¡â‘¢â‘£â‘¤]/, (m) => 'â‘ â‘¡â‘¢â‘£â‘¤'.indexOf(m) + 1)) : null;\n\n// í•´ì„¤ ì¶”ì¶œ\nconst explanation = parseSection('í•´ì„¤').replace(/```/g, '').trim();\n\n// í‚¤ì›Œë“œ ì¶”ì¶œ\nconst keywordsSection = parseSection('í‚¤ì›Œë“œ');\nconst keywords = keywordsSection.split(/[\\n,]/).map(k => k.replace(/^-\\s*/, '').trim()).filter(k => k);\n\n// JSON êµ¬ì¡° ìƒì„±\nreturn {\n  examYear: examYear + 'íšŒ',\n  number: questionNumber,\n  subject: subject,\n  question: question,\n  choices: choices,\n  answer: answer,\n  explanation: explanation,\n  keywords: keywords,\n  githubIssueNumber: $input.first().json.issue.number,\n  contributor: $input.first().json.issue.user.login,\n  createdAt: new Date().toISOString()\n};"
      }
    },
    {
      "id": "3",
      "name": "Validate Data",
      "type": "n8n-nodes-base.if",
      "position": [650, 300],
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json.question !== '' && Object.keys($json.choices).length === 5 && $json.answer !== null}}",
              "value2": true
            }
          ]
        }
      }
    },
    {
      "id": "4",
      "name": "Save to Database",
      "type": "n8n-nodes-base.postgres",
      "position": [850, 250],
      "parameters": {
        "operation": "insert",
        "table": "exam_questions",
        "columns": "exam_year,number,subject,question,choices,answer,explanation,keywords,github_issue,contributor",
        "additionalFields": {}
      }
    },
    {
      "id": "5",
      "name": "Slack Success Notification",
      "type": "n8n-nodes-base.slack",
      "position": [1050, 250],
      "parameters": {
        "channel": "#exam-contributions",
        "text": "âœ… ìƒˆë¡œìš´ ê¸°ì¶œë¬¸ì œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!\níšŒì°¨: {{$json.examYear}}\në¬¸ì œ ë²ˆí˜¸: {{$json.number}}\nê³¼ëª©: {{$json.subject}}\nê¸°ì—¬ì: @{{$json.contributor}}"
      }
    },
    {
      "id": "6",
      "name": "GitHub Comment",
      "type": "n8n-nodes-base.github",
      "position": [1050, 350],
      "parameters": {
        "operation": "createIssueComment",
        "owner": "voidlight",
        "repository": "tree-doctor-exam-crowdsource",
        "issueNumber": "={{$json.githubIssueNumber}}",
        "body": "âœ… ë¬¸ì œê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! ê°ì‚¬í•©ë‹ˆë‹¤.\n\nê²€ì¦ ìƒíƒœ: âœ“ í†µê³¼\n- ë¬¸ì œ: âœ“\n- ì„ íƒì§€ (5ê°œ): âœ“\n- ì •ë‹µ: âœ“\n- ê³¼ëª© ë¶„ë¥˜: âœ“\n\nê¸°ì—¬í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ğŸŒ³"
      }
    },
    {
      "id": "7",
      "name": "Validation Failed",
      "type": "n8n-nodes-base.github",
      "position": [850, 450],
      "parameters": {
        "operation": "createIssueComment",
        "owner": "voidlight",
        "repository": "tree-doctor-exam-crowdsource",
        "issueNumber": "={{$node['Parse Issue Content'].json.githubIssueNumber}}",
        "body": "âŒ ë°ì´í„° ê²€ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\në‹¤ìŒ í•­ëª©ì„ í™•ì¸í•´ì£¼ì„¸ìš”:\n- [ ] ë¬¸ì œ ë‚´ìš©ì´ ë¹„ì–´ìˆì§€ ì•Šì€ì§€\n- [ ] ì„ íƒì§€ê°€ ì •í™•íˆ 5ê°œì¸ì§€\n- [ ] ì •ë‹µì´ 1-5 ì‚¬ì´ì˜ ìˆ«ìì¸ì§€\n\nìˆ˜ì • í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
      }
    }
  ],
  "connections": {
    "GitHub Webhook": {
      "main": [[{"node": "Parse Issue Content", "type": "main", "index": 0}]]
    },
    "Parse Issue Content": {
      "main": [[{"node": "Validate Data", "type": "main", "index": 0}]]
    },
    "Validate Data": {
      "main": [
        [{"node": "Save to Database", "type": "main", "index": 0}],
        [{"node": "Validation Failed", "type": "main", "index": 0}]
      ]
    },
    "Save to Database": {
      "main": [
        [
          {"node": "Slack Success Notification", "type": "main", "index": 0},
          {"node": "GitHub Comment", "type": "main", "index": 0}
        ]
      ]
    }
  }
}